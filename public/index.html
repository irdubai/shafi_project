<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم حسابداری شافی</title>
    <link rel="stylesheet" href="index.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
</head>
<body>
    <!-- بخش وضعیت آنلاین -->
    <div id="online-status" class="online-status">
        <span id="status-indicator">🟢</span>
        <span id="status-text">آنلاین</span>
    </div>

    <!-- صفحه لاگین -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <h1>🏪 سیستم حسابداری شافی</h1>
                <p>لطفاً وارد حساب کاربری خود شوید</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="username">نام کاربری:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">رمز عبور:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">ورود</button>
            </form>
        </div>
    </div>

    <!-- اپلیکیشن اصلی -->
    <div id="app" class="app hidden">
        <!-- نوار کناری -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-toggle" id="sidebar-toggle">☰</button>
                <h2>سیستم حسابداری شافی</h2>
            </div>
            <div class="sidebar-content">
                <div class="app-info">
                    <h3>سیستم حسابداری شافی</h3>
                    <p>مدیریت کامل حسابداری</p>
                    <p>برنامه‌نویس: موسی بعاجی</p>
                </div>
                <ul class="nav-menu">
                    <li><a href="#" onclick="showSection('dashboard')" class="nav-link active">
                        <span class="nav-icon">📊</span> داشبورد
                    </a></li>
                    <li><a href="#" onclick="showSection('customers')" class="nav-link">
                        <span class="nav-icon">👥</span> مشتریان
                    </a></li>
                    <li><a href="#" onclick="showSection('products')" class="nav-link">
                        <span class="nav-icon">📦</span> کالاها
                    </a></li>
                    <li><a href="#" onclick="showSection('invoices')" class="nav-link">
                        <span class="nav-icon">📄</span> فاکتورها
                    </a></li>
                    <li><a href="#" onclick="showSection('expenses')" class="nav-link">
                        <span class="nav-icon">💰</span> هزینه‌ها
                    </a></li>
                    <li><a href="#" onclick="showSection('reports')" class="nav-link">
                        <span class="nav-icon">📈</span> گزارش‌ها
                    </a></li>
                    <li><a href="#" onclick="showSection('exchange')" class="nav-link">
                        <span class="nav-icon">💱</span> تبدیل ارز
                    </a></li>
                    <li><a href="#" onclick="showSection('payments')" class="nav-link">
                        <span class="nav-icon">💳</span> مدیریت پرداخت‌ها
                    </a></li>
                    <li><a href="#" onclick="logout()" class="nav-link logout">
                        <span class="nav-icon">🚪</span> خروج
                    </a></li>
                </ul>
            </div>
        </nav>

        <!-- محتوای اصلی -->
        <main class="main-content">
            <!-- بخش داشبورد -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>داشبورد</h2>
                    <button class="btn btn-primary" onclick="refreshDashboard()">به‌روزرسانی</button>
                </div>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3 id="customers-count">0</h3>
                        <p>تعداد مشتریان</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="products-count">0</h3>
                        <p>تعداد کالاها</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="invoices-count">0</h3>
                        <p>تعداد فاکتورها</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-sales">0</h3>
                        <p>کل فروش</p>
                    </div>
                </div>
                <div class="dashboard-content">
                    <div class="dashboard-widget">
                        <h3>کالاهای کم موجود</h3>
                        <div id="low-stock-products">داده‌ای موجود نیست</div>
                    </div>
                    <div class="dashboard-widget">
                        <h3>فاکتورهای اخیر</h3>
                        <div id="recent-invoices">داده‌ای موجود نیست</div>
                    </div>
                </div>
            </section>

            <!-- بخش مشتریان -->
            <section id="customers" class="content-section">
                <div class="section-header">
                    <h2>مدیریت مشتریان</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="generateCustomerReport()">گزارش صورتحساب</button>
                        <button class="btn btn-primary" onclick="openModal('customerModal')">➕ افزودن مشتری</button>
                    </div>
                </div>
                <div class="filters">
                    <input type="text" id="customer-search" placeholder="جستجو:" onkeyup="filterCustomers()">
                    <select id="customer-type-filter" onchange="filterCustomers()">
                        <option value="">نوع مشتری:</option>
                        <option value="">همه</option>
                        <option value="retail">خرده فروشی</option>
                        <option value="wholesale">عمده فروشی</option>
                        <option value="supplier">تأمین کننده</option>
                    </select>
                    <select id="customer-status-filter" onchange="filterCustomers()">
                        <option value="">وضعیت:</option>
                        <option value="">همه</option>
                        <option value="active">فعال</option>
                        <option value="inactive">غیرفعال</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>کد مشتری</th>
                                <th>نام</th>
                                <th>شرکت</th>
                                <th>تلفن</th>
                                <th>موجودی</th>
                                <th>وضعیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table">
                            <!-- داده‌های مشتریان -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- بخش کالاها -->
            <section id="products" class="content-section">
                <div class="section-header">
                    <h2>مدیریت کالاها</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="generateProductReport()">گزارش موجودی</button>
                        <button class="btn btn-primary" onclick="openModal('productModal')">➕ افزودن کالا</button>
                    </div>
                </div>
                <div class="filters">
                    <input type="text" id="product-search" placeholder="جستجو:" onkeyup="filterProducts()">
                    <select id="product-category-filter" onchange="filterProducts()">
                        <option value="">دسته‌بندی:</option>
                        <option value="">همه</option>
                    </select>
                    <select id="product-stock-filter" onchange="filterProducts()">
                        <option value="">وضعیت موجودی:</option>
                        <option value="">همه</option>
                        <option value="low">کم موجود</option>
                        <option value="available">موجود</option>
                        <option value="out">ناموجود</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>کد کالا</th>
                                <th>نام کالا</th>
                                <th>قیمت</th>
                                <th>واحد</th>
                                <th>موجودی</th>
                                <th>دسته‌بندی</th>
                                <th>وضعیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="products-table">
                            <!-- داده‌های کالاها -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- بخش فاکتورها -->
            <section id="invoices" class="content-section">
                <div class="section-header">
                    <h2>مدیریت فاکتورها</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="generateInvoiceReport()">گزارش فاکتورها</button>
                        <button class="btn btn-primary" onclick="openModal('invoiceModal')">➕ فاکتور جدید</button>
                    </div>
                </div>
                <div class="filters">
                    <select id="invoice-type-filter" onchange="filterInvoices()">
                        <option value="">نوع فاکتور:</option>
                        <option value="">همه</option>
                        <option value="sale">فروش</option>
                        <option value="purchase">خرید</option>
                        <option value="sale_return">مرجوعی فروش</option>
                        <option value="purchase_return">مرجوعی خرید</option>
                    </select>
                    <input type="date" id="invoice-date-from" onchange="filterInvoices()" placeholder="از تاریخ:">
                    <input type="date" id="invoice-date-to" onchange="filterInvoices()" placeholder="تا تاریخ:">
                    <select id="invoice-status-filter" onchange="filterInvoices()">
                        <option value="">وضعیت:</option>
                        <option value="">همه</option>
                        <option value="draft">پیش‌نویس</option>
                        <option value="confirmed">تأیید شده</option>
                        <option value="paid">پرداخت شده</option>
                        <option value="cancelled">لغو شده</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>شماره فاکتور</th>
                                <th>تاریخ</th>
                                <th>نوع</th>
                                <th>مشتری</th>
                                <th>مبلغ کل</th>
                                <th>پرداخت شده</th>
                                <th>مانده</th>
                                <th>وضعیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="invoices-table">
                            <!-- داده‌های فاکتورها -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- بخش هزینه‌ها -->
            <section id="expenses" class="content-section">
                <div class="section-header">
                    <h2>مدیریت هزینه‌ها</h2>
                    <div>
                        <button class="btn btn-primary" onclick="openModal('expenseModal')">افزودن هزینه جدید</button>
                        <button class="btn btn-secondary" onclick="generateExpenseReport()">📊 گزارش هزینه‌ها</button>
                    </div>
                </div>
                <div class="filters">
                    <input type="date" id="expense-date-from" onchange="filterExpenses()" placeholder="از تاریخ:">
                    <input type="date" id="expense-date-to" onchange="filterExpenses()" placeholder="تا تاریخ:">
                    <select id="expense-category-filter" onchange="filterExpenses()">
                        <option value="">دسته‌بندی:</option>
                        <option value="">همه</option>
                        <option value="administrative">اداری</option>
                        <option value="transport">حمل و نقل</option>
                        <option value="marketing">بازاریابی</option>
                        <option value="services">خدمات</option>
                        <option value="rent">اجاره</option>
                        <option value="supplies">لوازم</option>
                        <option value="other">سایر</option>
                    </select>
                    <select id="expense-payment-filter" onchange="filterExpenses()">
                        <option value="">روش پرداخت:</option>
                        <option value="">همه</option>
                        <option value="cash">نقدی</option>
                        <option value="bank">بانکی</option>
                        <option value="card">کارتی</option>
                        <option value="check">چک</option>
                    </select>
                </div>
                <div class="share-options">
                    <h4>اشتراک:</h4>
                    <button class="share-btn whatsapp" onclick="shareExpenses('whatsapp')">واتساپ</button>
                    <button class="share-btn telegram" onclick="shareExpenses('telegram')">تلگرام</button>
                    <button class="share-btn copy" onclick="shareExpenses('copy')">کپی متن</button>
                    <button class="share-btn rubika" onclick="shareExpenses('rubika')">روبیکا</button>
                    <button class="share-btn eitaa" onclick="shareExpenses('eitaa')">ایتا</button>
                    <button class="share-btn bale" onclick="shareExpenses('bale')">بله</button>
                    <button class="share-btn sms" onclick="shareExpenses('sms')">پیامک</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>تاریخ</th>
                                <th>شرح</th>
                                <th>مبلغ</th>
                                <th>دسته‌بندی</th>
                                <th>وضعیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="expenses-table">
                            <!-- داده‌های هزینه‌ها -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- بخش گزارش‌ها -->
            <section id="reports" class="content-section">
                <div class="section-header">
                    <h2>گزارش‌ها و تحلیل‌ها</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="generateProfitLoss()">گزارش سود و زیان</button>
                        <button class="btn btn-primary" onclick="exportAllReports()">📁 صادرات همه گزارش‌ها</button>
                    </div>
                </div>
                <div class="report-filters">
                    <input type="date" id="report-date-from" placeholder="از تاریخ:">
                    <input type="date" id="report-date-to" placeholder="تا تاریخ:">
                    <select id="report-type">
                        <option value="sales">نوع گزارش:</option>
                        <option value="sales">فروش</option>
                        <option value="purchases">خرید</option>
                        <option value="expenses">هزینه‌ها</option>
                        <option value="customers">مشتریان</option>
                        <option value="products">کالاها</option>
                        <option value="profit_loss">سود و زیان</option>
                    </select>
                    <select id="report-customer">
                        <option value="">مشتری:</option>
                        <option value="">همه مشتریان</option>
                    </select>
                    <select id="report-product">
                        <option value="">محصول:</option>
                        <option value="">همه محصولات</option>
                    </select>
                    <select id="report-currency">
                        <option value="">ارز:</option>
                        <option value="">همه ارزها</option>
                        <option value="AED">درهم</option>
                        <option value="IRR">ریال</option>
                        <option value="USD">دلار</option>
                        <option value="EUR">یورو</option>
                        <option value="CNY">یوان</option>
                    </select>
                    <button class="btn btn-primary" onclick="generateReport()">تولید گزارش</button>
                </div>
                <div class="report-summary">
                    <div class="stat-card">
                        <h3 id="total-sales-report">0</h3>
                        <p>کل فروش</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-purchases-report">0</h3>
                        <p>کل خرید</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-expenses-report">0</h3>
                        <p>کل هزینه‌ها</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="net-profit-report">0</h3>
                        <p>سود خالص</p>
                    </div>
                </div>
                <div id="report-content">
                    <!-- محتوای گزارش -->
                </div>
            </section>

            <!-- بخش تبدیل ارز -->
            <section id="exchange" class="content-section">
                <div class="section-header">
                    <h2>تبدیل ارز و مدیریت نرخ‌ها</h2>
                </div>
                <div class="exchange-content">
                    <div class="exchange-calculator">
                        <h3>محاسبه تبدیل ارز</h3>
                        <div class="form-group">
                            <label>مبلغ:</label>
                            <input type="number" id="exchange-amount" placeholder="مبلغ را وارد کنید">
                        </div>
                        <div class="form-group">
                            <label>از ارز:</label>
                            <select id="exchange-from">
                                <option value="AED">درهم (AED)</option>
                                <option value="IRR">ریال (IRR)</option>
                                <option value="USD">دلار (USD)</option>
                                <option value="EUR">یورو (EUR)</option>
                                <option value="CNY">یوان (CNY)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="calculateExchange()">تبدیل</button>
                        <div class="form-group">
                            <label>به ارز:</label>
                            <select id="exchange-to">
                                <option value="AED">درهم (AED)</option>
                                <option value="IRR">ریال (IRR)</option>
                                <option value="USD">دلار (USD)</option>
                                <option value="EUR">یورو (EUR)</option>
                                <option value="CNY">یوان (CNY)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>نتیجه:</label>
                            <input type="text" id="exchange-result" readonly value="--">
                        </div>
                    </div>
                    <div class="exchange-rates">
                        <h3>مدیریت نرخ ارز</h3>
                        <div class="form-group">
                            <label>از ارز:</label>
                            <select id="rate-from">
                                <option value="AED">درهم (AED)</option>
                                <option value="IRR">ریال (IRR)</option>
                                <option value="USD">دلار (USD)</option>
                                <option value="EUR">یورو (EUR)</option>
                                <option value="CNY">یوان (CNY)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>به ارز:</label>
                            <select id="rate-to">
                                <option value="AED">درهم (AED)</option>
                                <option value="IRR">ریال (IRR)</option>
                                <option value="USD">دلار (USD)</option>
                                <option value="EUR">یورو (EUR)</option>
                                <option value="CNY">یوان (CNY)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>نرخ تبدیل:</label>
                            <input type="number" id="exchange-rate" step="0.0001" placeholder="نرخ را وارد کنید">
                        </div>
                        <button class="btn btn-primary" onclick="saveExchangeRate()">ذخیره نرخ ارز</button>
                    </div>
                </div>
                <div class="rates-table">
                    <h3>نرخ‌های فعلی ارز</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>از ارز</th>
                                <th>به ارز</th>
                                <th>نرخ</th>
                                <th>تاریخ به‌روزرسانی</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="exchange-rates-table">
                            <!-- نرخ‌های ارز -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- بخش پرداخت‌ها -->
            <section id="payments" class="content-section">
                <div class="section-header">
                    <h2>مدیریت پرداخت‌ها</h2>
                    <div>
                        <button class="btn btn-primary" onclick="openModal('paymentModal')">افزودن پرداخت جدید</button>
                        <button class="btn btn-secondary" onclick="generatePaymentReport()">📊 گزارش پرداخت‌ها</button>
                    </div>
                </div>
                <div class="filters">
                    <input type="date" id="payment-date-from" onchange="filterPayments()" placeholder="از تاریخ:">
                    <input type="date" id="payment-date-to" onchange="filterPayments()" placeholder="تا تاریخ:">
                    <select id="payment-type-filter" onchange="filterPayments()">
                        <option value="">نوع پرداخت:</option>
                        <option value="">همه</option>
                        <option value="cash">نقدی</option>
                        <option value="bank">بانکی</option>
                        <option value="card">کارتی</option>
                        <option value="check">چک</option>
                        <option value="credit">اعتباری</option>
                    </select>
                    <select id="payment-status-filter" onchange="filterPayments()">
                        <option value="">وضعیت:</option>
                        <option value="">همه</option>
                        <option value="confirmed">تأیید شده</option>
                        <option value="pending">در انتظار</option>
                        <option value="cancelled">لغو شده</option>
                        <option value="returned">برگشت خورده</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>تاریخ</th>
                                <th>مشتری</th>
                                <th>فاکتور</th>
                                <th>مبلغ</th>
                                <th>نوع پرداخت</th>
                                <th>شماره مرجع</th>
                                <th>وضعیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="payments-table">
                            <!-- داده‌های پرداخت‌ها -->
                        </tbody>
                    </table>
                </div>
                <div class="payment-summary">
                    <h3>خلاصه پرداخت‌ها</h3>
                    <div class="payment-stats">
                        <div class="stat-card">
                            <h3 id="total-cash-payments">0</h3>
                            <p>کل پرداخت‌های نقدی</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-bank-payments">0</h3>
                            <p>کل پرداخت‌های بانکی</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-card-payments">0</h3>
                            <p>کل پرداخت‌های کارتی</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="pending-payments">0</h3>
                            <p>پرداخت‌های در انتظار</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- مودال‌ها -->
    <!-- مودال مشتری جدید -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>مشتری جدید</h2>
                <span class="close" onclick="closeModal('customerModal')">&times;</span>
            </div>
            <form id="customerForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>کد مشتری:</label>
                        <input type="text" id="customer-code" required>
                    </div>
                    <div class="form-group">
                        <label>نام:</label>
                        <input type="text" id="customer-name" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>شرکت:</label>
                        <input type="text" id="customer-company">
                    </div>
                    <div class="form-group">
                        <label>تلفن:</label>
                        <input type="tel" id="customer-phone">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ایمیل:</label>
                        <input type="email" id="customer-email">
                    </div>
                    <div class="form-group">
                        <label>شهر:</label>
                        <input type="text" id="customer-city">
                    </div>
                </div>
                <div class="form-group">
                    <label>آدرس:</label>
                    <textarea id="customer-address"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>نوع موجودی:</label>
                        <select id="customer-balance-type">
                            <option value="creditor">بستانکار</option>
                            <option value="debtor">بدهکار</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>موجودی:</label>
                        <input type="number" id="customer-balance" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>واحد پولی:</label>
                        <select id="customer-currency">
                            <option value="AED">درهم (AED)</option>
                            <option value="IRR">ریال (IRR)</option>
                            <option value="USD">دلار (USD)</option>
                            <option value="EUR">یورو (EUR)</option>
                            <option value="CNY">یوان (CNY)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>نوع مشتری:</label>
                        <select id="customer-type">
                            <option value="retail">خرده فروشی</option>
                            <option value="wholesale">عمده فروشی</option>
                            <option value="supplier">تأمین کننده</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="customer-active" checked>
                        فعال
                    </label>
                </div>
                <div class="form-group">
                    <label>یادداشت:</label>
                    <textarea id="customer-notes"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('customerModal')">انصراف</button>
                    <button type="submit" class="btn btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>

    <!-- مودال کالای جدید -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>کالای جدید</h2>
                <span class="close" onclick="closeModal('productModal')">&times;</span>
            </div>
            <form id="productForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>کد کالا:</label>
                        <input type="text" id="product-code" required>
                    </div>
                    <div class="form-group">
                        <label>نام کالا:</label>
                        <input type="text" id="product-name" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>قیمت:</label>
                        <input type="number" id="product-price" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>واحد پولی:</label>
                        <select id="product-currency">
                            <option value="AED">درهم (AED)</option>
                            <option value="IRR">ریال (IRR)</option>
                            <option value="USD">دلار (USD)</option>
                            <option value="EUR">یورو (EUR)</option>
                            <option value="CNY">یوان (CNY)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>واحد:</label>
                        <input type="text" id="product-unit" required>
                    </div>
                    <div class="form-group">
                        <label>موجودی:</label>
                        <input type="number" id="product-stock" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>دسته‌بندی:</label>
                        <input type="text" id="product-category">
                    </div>
                    <div class="form-group">
                        <label>حداقل موجودی:</label>
                        <input type="number" id="product-min-stock" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>محل نگهداری:</label>
                    <input type="text" id="product-location">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="product-active" checked>
                        فعال
                    </label>
                </div>
                <div class="form-group">
                    <label>توضیحات:</label>
                    <textarea id="product-description"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">انصراف</button>
                    <button type="submit" class="btn btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>

    <!-- مودال فاکتور جدید -->
    <div id="invoiceModal" class="modal large-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>فاکتور جدید</h2>
                <span class="close" onclick="closeModal('invoiceModal')">&times;</span>
            </div>
            <form id="invoiceForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>شماره فاکتور:</label>
                        <input type="text" id="invoice-number" required>
                    </div>
                    <div class="form-group">
                        <label>تاریخ:</label>
                        <input type="date" id="invoice-date" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>نوع فاکتور:</label>
                        <select id="invoice-type" required>
                            <option value="sale">فروش</option>
                            <option value="purchase">خرید</option>
                            <option value="sale_return">مرجوعی فروش</option>
                            <option value="purchase_return">مرجوعی خرید</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>وضعیت:</label>
                        <select id="invoice-status">
                            <option value="draft">پیش‌نویس</option>
                            <option value="confirmed">تأیید شده</option>
                            <option value="paid">پرداخت شده</option>
                            <option value="cancelled">لغو شده</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>مشتری:</label>
                        <select id="invoice-customer" required>
                            <option value="">انتخاب مشتری</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ارز فاکتور:</label>
                        <select id="invoice-currency">
                            <option value="AED">درهم (AED)</option>
                            <option value="IRR">ریال (IRR)</option>
                            <option value="USD">دلار (USD)</option>
                            <option value="EUR">یورو (EUR)</option>
                            <option value="CNY">یوان (CNY)</option>
                        </select>
                    </div>
                </div>
                <div class="invoice-items">
                    <h3>آیتم‌های فاکتور:</h3>
                    <button type="button" class="btn btn-small" onclick="addInvoiceItem()">➕ افزودن آیتم</button>
                    <div id="invoice-items-container">
                        <!-- آیتم‌های فاکتور -->
                    </div>
                </div>
                <div class="form-group">
                    <label>توضیحات:</label>
                    <textarea id="invoice-description"></textarea>
                </div>
                <div class="invoice-totals">
                    <div class="totals-row">
                        <label>جمع کل:</label>
                        <span id="invoice-subtotal">0</span>
                    </div>
                    <div class="totals-row">
                        <label>تخفیف:</label>
                        <input type="number" id="invoice-discount" value="0" onchange="calculateInvoiceTotal()">
                        <span>AED</span>
                    </div>
                    <div class="totals-row">
                        <label>مالیات:</label>
                        <input type="number" id="invoice-tax" value="0" onchange="calculateInvoiceTotal()">
                        <span>AED</span>
                    </div>
                    <div class="totals-row total">
                        <label><strong>مبلغ نهایی:</strong></label>
                        <span id="invoice-total"><strong>0 AED</strong></span>
                    </div>
                    <div class="totals-row">
                        <label>پرداخت شده:</label>
                        <input type="number" id="invoice-paid" value="0" onchange="calculateInvoiceBalance()">
                        <span>AED</span>
                    </div>
                    <div class="totals-row balance">
                        <label><strong>مانده:</strong></label>
                        <span id="invoice-balance"><strong>0 AED</strong></span>
                    </div>
                </div>
                <div class="invoice-actions">
                    <button type="button" class="btn btn-info" onclick="previewInvoice()">پیش نمایش</button>
                    <button type="button" class="btn btn-secondary" onclick="printInvoice('normal')">🖨️ چاپ معمولی</button>
                    <button type="button" class="btn btn-secondary" onclick="printInvoice('thermal')">🖨️ چاپ حرارتی</button>
                    <button type="button" class="btn btn-info" onclick="exportInvoicePDF()">📄 PDF</button>
                </div>
                <div class="share-section">
                    <h4>اشتراک‌گذاری</h4>
                    <div class="share-buttons">
                        <button type="button" class="share-btn whatsapp" onclick="shareInvoice('whatsapp')">واتساپ</button>
                        <button type="button" class="share-btn telegram" onclick="shareInvoice('telegram')">تلگرام</button>
                        <button type="button" class="share-btn rubika" onclick="shareInvoice('rubika')">روبیکا</button>
                        <button type="button" class="share-btn eitaa" onclick="shareInvoice('eitaa')">ایتا</button>
                        <button type="button" class="share-btn bale" onclick="shareInvoice('bale')">بله</button>
                        <button type="button" class="share-btn sms" onclick="shareInvoice('sms')">پیامک</button>
                        <button type="button" class="share-btn copy" onclick="shareInvoice('copy')">کپی متن</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('invoiceModal')">انصراف</button>
                    <button type="submit" class="btn btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>

    <!-- مودال پیش نمایش فاکتور -->
    <div id="invoicePreviewModal" class="modal large-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>پیش نمایش فاکتور</h2>
                <span class="close" onclick="closeModal('invoicePreviewModal')">&times;</span>
            </div>
            <div id="invoice-preview-content" class="invoice-preview">
                <!-- محتوای پیش نمایش فاکتور -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('invoicePreviewModal')">بستن پیش نمایش</button>
            </div>
        </div>
    </div>

    <!-- مودال هزینه جدید -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>هزینه جدید</h2>
                <span class="close" onclick="closeModal('expenseModal')">&times;</span>
            </div>
            <form id="expenseForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>تاریخ:</label>
                        <input type="date" id="expense-date" required>
                    </div>
                    <div class="form-group">
                        <label>شرح:</label>
                        <input type="text" id="expense-description" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>مبلغ:</label>
                        <input type="number" id="expense-amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>واحد پولی:</label>
                        <select id="expense-currency">
                            <option value="AED">درهم (AED)</option>
                            <option value="IRR">ریال (IRR)</option>
                            <option value="USD">دلار (USD)</option>
                            <option value="EUR">یورو (EUR)</option>
                            <option value="CNY">یوان (CNY)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>دسته‌بندی:</label>
                        <select id="expense-category" required>
                            <option value="administrative">اداری</option>
                            <option value="transport">حمل و نقل</option>
                            <option value="marketing">بازاریابی</option>
                            <option value="services">خدمات</option>
                            <option value="rent">اجاره</option>
                            <option value="supplies">لوازم</option>
                            <option value="other">سایر</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>روش پرداخت:</label>
                        <select id="expense-payment-method">
                            <option value="cash">نقدی</option>
                            <option value="bank">بانکی</option>
                            <option value="card">کارتی</option>
                            <option value="check">چک</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>یادداشت:</label>
                    <textarea id="expense-notes"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('expenseModal')">انصراف</button>
                    <button type="submit" class="btn btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>

    <!-- مودال پرداخت جدید -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>پرداخت جدید</h2>
                <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            </div>
            <form id="paymentForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>تاریخ:</label>
                        <input type="date" id="payment-date" required>
                    </div>
                    <div class="form-group">
                        <label>مشتری:</label>
                        <select id="payment-customer" required>
                            <option value="">انتخاب مشتری</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>فاکتور مرتبط:</label>
                    <select id="payment-invoice">
                        <option value="">انتخاب فاکتور (اختیاری)</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>مبلغ:</label>
                        <input type="number" id="payment-amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>واحد پولی:</label>
                        <select id="payment-currency">
                            <option value="AED">درهم (AED)</option>
                            <option value="IRR">ریال (IRR)</option>
                            <option value="USD">دلار (USD)</option>
                            <option value="EUR">یورو (EUR)</option>
                            <option value="CNY">یوان (CNY)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>نوع پرداخت:</label>
                        <select id="payment-type" required>
                            <option value="cash">نقدی</option>
                            <option value="bank">بانکی</option>
                            <option value="card">کارتی</option>
                            <option value="check">چک</option>
                            <option value="credit">اعتباری</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>شماره مرجع:</label>
                        <input type="text" id="payment-reference">
                    </div>
                </div>
                <div class="form-group">
                    <label>وضعیت:</label>
                    <select id="payment-status">
                        <option value="confirmed">تأیید شده</option>
                        <option value="pending">در انتظار</option>
                        <option value="cancelled">لغو شده</option>
                        <option value="returned">برگشت خورده</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>توضیحات:</label>
                    <textarea id="payment-description"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">انصراف</button>
                    <button type="submit" class="btn btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>

    <!-- فوتر -->
    <footer class="footer">
        <p>توسعه‌دهنده: موسی بعاجی</p>
    </footer>

    <!-- JavaScript Files - نهایی و صحیح -->
    <script src="common.js"></script>
    <script src="customers.js"></script>
    <script src="products.js"></script>
    <script src="invoices.js"></script>
    <script src="reports.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(function(registration) {
                    console.log('Service Worker registered successfully:', registration.scope);
                })
                .catch(function(error) {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>
